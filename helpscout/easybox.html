
<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Al ras del suelo</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />

<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js'></script>
<script src='http://hostingdenise.t15.org/easybox/distrib.min.js'></script>



<link href='http://hostingdenise.t15.org/easybox/styles/default/easybox.min.css' rel='stylesheet' />


<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; height: 50%}
</style>

</head>
<body>






<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>





<div id='map'></div>


<div id='chuchu' style='position:absolute; bottom:0'>
<br />
<br />


<a href="https://lh4.googleusercontent.com/-o6b31V-p8Og/U35FPN1yFmI/AAAAAAAACZg/sbIjMCteu3A/w423-h636-no/13.jpg" class="lightbox"><img src="http://t1.gstatic.com/images?q=tbn:ANd9GcQ7MPYwvLk_8JJQRRKuq1Fyyd5Kx9p6Q77X1GlZiWqpt7n_WQ2_" alt=""></a>

<br />
<br />
</div>


<style>

/*	.leaflet-popup-content-wrapper { width: 442px }
  .leaflet-popup-content { width: 442px !important }
  .leaflet-popup-content p { width:100% !important}
  .leaflet-popup-content img { max-width: 100% ; max-height: 100% }
  img { max-width: 100%; max-height: 100%; }
  .video {max-width: 442px; max-height: 542px }
  .photo {width: 100px; height: 100px}
  .photo img {max-width: 100%; max-height: 100% }*/


.popup {
  text-align:center;
  }
/*.popup .content .thumbnail        { display:none; }
.popup .content .thumbnail.active { display:block; }*/
.popup .content img {
  width:100%;
  }
.popup .content .description {
  background:#eee;
  padding:10px;
  }

</style>








<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiYWxyYXNkZWxzdWVsbyIsImEiOiJKYkRfV3MwIn0.wOB9_0X44dIHgl2CTT2e3Q';

var map = L.mapbox.map('map', 'alrasdelsuelo.i9872fo7', {
  maxBounds: L.latLngBounds(L.latLng(41.5065, 1.9164), L.latLng(41.3010, 2.4307)),
  maxZoom: 19,
  minZoom: 12
  }).setView([41.40354, 2.17443], 13);

// zoom the map to that bounding box
//map.fitBounds(bounds);

// Omnivore will AJAX-request this file behind the scenes and parse it:
// note that there are considerations:
// - The CSV file must contain latitude and longitude values, in column
//   named roughly latitude and longitude
// - The file must either be on the same domain as the page that requests it,
//   or both the server it is requested from and the user's browser must
//   support CORS.
omnivore.csv('points5.csv')
    .on('ready', function(layer) {

        this.eachLayer(function(marker) {

      marker.setIcon(L.mapbox.marker.icon({}));

      // Create custom popup content from the CSV properties
      var	popupName =  marker.toGeoJSON().properties.name,
        popupThumbnail =  marker.toGeoJSON().properties.thumbnail,
        popupMedia =  marker.toGeoJSON().properties.media,
        popupDescription =  marker.toGeoJSON().properties.description;


      var popupContents =

//			<div>' + '<h2>' + popupName + '<\/h2>' + '<br\/>' + '<\/div>' +
//			<div class="video">' + popupVideo + '<br\/>' + '<\/div>' +
//			<div class="photo">' + popupPhoto + '<br\/>' + '<\/div>' +
//			<div>' + '<p>' + popupDescription + '<\/p>' + '<\/div>';


      '<div class="popup">' + '<h2>' + 'derp' + '</h2>' +
        '<div class="content">' +
          '<div class="thumbnail">' + '<a href="' + popupMedia + '" class="lightbox">' + '<img src="' + popupThumbnail + '" alt="">' + '</a>' +
            '<div class="description">' + popupDescription +
            '</div>' +
          '</div>'
        '</div>'
      '</div>';




            // Bind a popup to each icon based on the same properties
            marker.bindPopup(popupContents,{
        //Popup options
        maxWidth: 300, minWidth: 250,
        maxHeight: 0, autoPan: true, closeButton: true, autoPanPadding: new L.Point(5, 5)
        });

        marker.on('click', function(){

          console.log('click func')
          var linkMapper = function(el) {
            // create a resource object with href as url and title as caption
            return {url: el.href, caption: el.title};
          };
          var linkFilter = function(el) {
            // must return true if the same, otherwise only true if data-group equals
            return (this == el) || ((this.hasAttribute("data-group")) && (this.getAttribute("data-group") == el.getAttribute("data-group")));
          };
          var dynamicOptions = function(el) {
            // disable drag and drop if specified
            if (el.hasAttribute("data-no-dragdrop"))
              return {dragDrop: false}
              return {}
            };
            $("a.lightbox").easybox({}, linkMapper, linkFilter, dynamicOptions);
        })

        });
    })
    .addTo(map);


</script>

</body>
</html>
